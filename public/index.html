<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Foto Evento</title>
</head>
<body>
  <form id="uploadForm">
    <input type="file" name="image" accept="image/*" required />
    <input type="text" name="phone" placeholder="Telefone com DDD" required />
    <button type="submit">Enviar</button>
  </form>

  <div id="preview" style="margin-top: 20px; display:none;">
    <h3>Imagem Processada:</h3>
    <img id="resultImage" src="" alt="Imagem final" style="max-width: 300px;" />
    <br><br>
    <a id="whatsLink" href="#" target="_blank">
      <button>Enviar no WhatsApp</button>
    </a>
  </div>

  <script>
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(e.target);

      const response = await fetch('/api/process-image', {
        method: 'POST',
        body: formData
      });

      const result = await response.json();

      if (result?.url) {
        document.getElementById('preview').style.display = 'block';
        document.getElementById('resultImage').src = result.url;

        const message = encodeURIComponent('Sua imagem est√° pronta!');
        const link = `https://wa.me/55${result.phone}?text=${message}`;
        document.getElementById('whatsLink').href = link;
      }
    });
  </script>
</body>
</html>